<!DOCTYPE html>
<html>
    <head>
        <title>Visual Association</title>
        <script src="jspsych/dist/jspsych.js"></script>
        <script src="jspsych/dist/plugin-html-keyboard-response.js"></script>
        <script src="jspsych/dist/plugin-html-button-response.js"></script>
        <script src="jspsych/dist/plugin-instructions.js"></script>
        <script src="jspsych/dist/plugin-external-html.js"></script>
        <script src="jspsych/dist/plugin-survey-multi-choice.js"></script>
        <script src="jspsych/dist/plugin-survey-text.js"></script>
        <script src="jspsych/dist/plugin-instructions.js"></script>
        <script src="jspsych/dist/plugin-audio-button-response.js"></script>
        <script src="jspsych/dist/plugin-canvas-keyboard-response.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
        <script src="helper_files/mturkfunctions.js"></script>
        <script src="animation.js"></script>
        <link href="jspsych/dist/jspsych.css" rel="stylesheet" type="text/css">
    </head>
    <body></body>
    <canvas id="myCanvas" width="450" height="450"></canvas>
    <script>
        var jsPsych = initJsPsych({
            show_progress_bar: false,
            override_safe_mode: true
        });
        var timeline = [];

        var c = document.getElementById("myCanvas");
        var trial_anim = {
            type: jsPsychCanvasKeyboardResponse,
            stimulus: function dummy_function(c) {
                var ctx = c.getContext("2d");        
                // try to make a shape show up on screen
                // ctx.beginPath();
                // ctx.moveTo(0,50)
                // ctx.rect(0,0,450/3,450/3);
                // ctx.stroke();
                var count = 0;
                // next try to *animate* a rectangle moving
                $(function(){
                    var colors = ["blue", "red", "green", "black"]
                    ctx.fillStyle = colors[Math.floor(Math.random()*colors.length)];
                    var x = 0;
                    function render(){
                        ctx.beginPath()
                        ctx.arc(c.width/2, c.height/2, 1, 0, 2 * Math.PI);
                        ctx.clearRect(0,0,c.width,c.height)
                        ctx.strokeRect(500,500, c.width, c.height)
                        var move = x
                        ctx.moveTo(x,0)
                        ctx.rect(0,0,500,500)
                        ctx.fillRect(0+x,200,450/4,450/4)
                        ctx.fillRect(375-x, 200, 450/4,450/4)
                        ctx.stroke()
                        x+=5
                        if(x > c.width+70){
                            x = -100
                        }
                        if(move === (c.width/2)+5){
                            var context = new AudioContext();
                            var oscillator = context.createOscillator();
                            oscillator.type = "sine";
                            oscillator.frequency.value = 800;
                            oscillator.connect(context.destination);
                            oscillator.start();
                            // Beep for 500 milliseconds
                            setTimeout(function () {
                                oscillator.stop();
                            }, 100);
                            console.log("beep")
                        }
                        requestAnimationFrame(render);
                    }
                    render();
                })
                
            },
            //canvas_size: [450, 450],
            choices: 'NO_KEYS',
            trial_duration: 200000
        };
        timeline.push(trial_anim);

        jsPsych.run(timeline)
    </script>